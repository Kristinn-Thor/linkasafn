(this["webpackJsonphackernews-react-apollo"]=this["webpackJsonphackernews-react-apollo"]||[]).push([[0],{108:function(e,n,t){},109:function(e,n,t){"use strict";t.r(n);var a,s,r,i,c,l,o,j=t(3),d=t.n(j),u=t(72),b=t.n(u),O=t(111),p=(t(89),t(29)),m=t(8),h=t(5),f=t(7),x=t(9),v=t(28),g=Object(x.gql)(a||(a=Object(v.a)(["\n  mutation PostMutation(\n    $description: String!\n    $url: String!\n    ) {\n      post(description: $description, url: $url) {\n        id\n        url\n        description\n      }\n    }\n"]))),k=Object(x.gql)(s||(s=Object(v.a)(["\n  mutation SignupMutation(\n    $email: String!\n    $password: String!\n    $name: String!\n  ) {\n    signup(\n      email: $email\n      password: $password\n      name: $name\n    ) {\n      token\n    }\n  }\n"]))),y=Object(x.gql)(r||(r=Object(v.a)(["\n  mutation LoginMutation(\n    $email: String!\n    $password: String!\n  ) {\n    login(email: $email, password: $password) {\n      token\n    }\n  }\n"]))),N=Object(x.gql)(i||(i=Object(v.a)(["\n  mutation VoteMutation($linkId: ID!) {\n    vote(linkId: $linkId) {\n      id\n      link {\n        id\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      user {\n        id\n      }\n    }\n  }\n"]))),w=t(1),C=function(){var e=Object(j.useState)({description:"",url:""}),n=Object(f.a)(e,2),t=n[0],a=n[1],s=Object(j.useState)({error:!1,message:"Obbos\xed villa vi\xf0 a\xf0 skr\xe1 link"}),r=Object(f.a)(s,2),i=r[0],c=r[1],l=Object(m.g)(),o=Object(x.useMutation)(g,{variables:{description:t.description,url:t.url},onError:function(e){"\xde\xfa ver\xf0ur \xe1 skr\xe1 \xfeig inn fyrst"!==e.message&&"Linkur \xfearf a\xf0 vera URL"!==e.message?c(Object(h.a)(Object(h.a)({},i),{},{error:!0})):c({error:!0,message:e.message})},onCompleted:function(){return l.push("/")}}),d=Object(f.a)(o,1)[0];return Object(w.jsxs)(w.Fragment,{children:[i.error&&Object(w.jsxs)("div",{className:"form-error",children:[Object(w.jsx)("h2",{children:"Villa"}),Object(w.jsx)("p",{children:i.message})]}),Object(w.jsxs)("form",{className:"form",onSubmit:function(e){e.preventDefault(),d()},children:[Object(w.jsx)("input",{className:"input",value:t.description,onChange:function(e){return a(Object(h.a)(Object(h.a)({},t),{},{description:e.target.value}))},type:"text",placeholder:"L\xfdsing \xe1 linknum"}),Object(w.jsx)("div",{className:"form-underline --purple"}),Object(w.jsx)("input",{className:"input",value:t.url,onChange:function(e){return a(Object(h.a)(Object(h.a)({},t),{},{url:e.target.value}))},type:"text",placeholder:"Vefsl\xf3\xf0in \xe1 linkinn"}),Object(w.jsx)("div",{className:"form-underline --purple"}),Object(w.jsx)("button",{className:"button --submit",type:"submit",children:"Skr\xe1 link"})]})]})},S=t(57),$=t.n(S),I=t(76),B=t(110),q="auth-token",E=function(){var e=Object(B.a)([q]),n=Object(f.a)(e,3),t=n[0],a=n[1],s=n[2];return[t[q],function(e){return a(q,e,{SameSite:"strict"})},function(){return s(q)}]};function M(e){var n=parseInt(e,10);return function(e,n){var t=6e4,a=36e5,s=864e5,r=2592e6,i=31536e6,c=e-n;return c<2e4?"just now":c<t?"less than 1 min ago":c<a?Math.round(c/t)+" min ago":c<s?Math.round(c/a)+" h ago":c<r?Math.round(c/s)+" days ago":c<i?Math.round(c/r)+" mo ago":Math.round(c/i)+" years ago"}((new Date).getTime(),new Date(n).getTime())}var L=Object(x.gql)(c||(c=Object(v.a)(["\n query FeedQuery($type: ID, $orderBy: LinkOrderByInput, $skip: Int, $take: Int){\n    feed(type: $type, orderBy: $orderBy, skip: $skip, take:$take) {\n      count\n      id\n      links {\n        id\n        createdAt\n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n    }\n  }\n"]))),A=Object(x.gql)(l||(l=Object(v.a)(["\n query FeedQueryTop($type: ID, $orderBy: LinkOrderByInput, $skip: Int, $take: Int){\n    feed(type: $type, orderBy: $orderBy, skip: $skip, take:$take) {\n      count\n      id\n      links {\n        id\n        createdAt\n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votesCount\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n    }\n  }\n"]))),F=Object(x.gql)(o||(o=Object(v.a)(["\n  query FeedSearchQuery($type: ID, $filter: String!) {\n    feed(type: $type, filter: $filter) {\n      id\n      links {\n        id\n        url\n        description\n        createdAt\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n    }\n  }\n"]))),D=t(82),Q=function(e,n){return e?{type:n,take:10,skip:10*(e-1),orderBy:{createdAt:"desc"}}:{}},V=function(e,n,t,a){if(n.readQuery(e)){var s=n.readQuery(e).feed.links.map((function(e){return e.id===t.id?Object(h.a)(Object(h.a)({},e),{},{votes:[].concat(Object(D.a)(e.votes),[a])}):e})),r=Object(h.a)(Object(h.a)({},e),{},{data:{feed:{links:s}}});n.writeQuery(r)}},T=(t(102),function(e){var n=e.link,t=e.page,a=e.index,s=E(),r=Object(f.a)(s,2)[0],i=Object(x.useMutation)(N,{variables:{linkId:n.id},onError:function(e){return console.info(e.message)},update:function(e,a){var s=a.data.vote,r={query:A,variables:{type:"top-feed",skip:0,take:20,orderBy:{votesCount:"desc"}}},i={query:L,variables:Q(t,"main-feed")};V(r,e,n,s),V(i,e,n,s)}}),c=Object(f.a)(i,1)[0];return Object(w.jsxs)("div",{className:"links",children:[Object(w.jsxs)("div",{className:"links-index",children:[Object(w.jsxs)("span",{children:[" ",a+1,". "]}),r&&Object(w.jsx)("div",{className:"links-vote",onClick:c,children:"\u25b2"})]}),Object(w.jsxs)("div",{className:"links-content",children:[Object(w.jsxs)("div",{className:"links-text",children:[n.description," - ",Object(w.jsx)("a",{className:"links-url",href:"https://"+n.url,children:n.url})]}),r&&Object(w.jsxs)("div",{className:"links-info",children:[n.votes.length," votes | by ",n.postedBy.name," ",M(n.createdAt)]})]})]})}),P=function(){return Object(w.jsx)("section",{className:"loader",children:Object(w.jsxs)("div",{className:"dots",children:[Object(w.jsx)("span",{style:{"--i":1}}),Object(w.jsx)("span",{style:{"--i":2}}),Object(w.jsx)("span",{style:{"--i":3}}),Object(w.jsx)("span",{style:{"--i":4}}),Object(w.jsx)("span",{style:{"--i":5}}),Object(w.jsx)("span",{style:{"--i":6}}),Object(w.jsx)("span",{style:{"--i":7}}),Object(w.jsx)("span",{style:{"--i":8}}),Object(w.jsx)("span",{style:{"--i":9}}),Object(w.jsx)("span",{style:{"--i":10}}),Object(w.jsx)("span",{style:{"--i":11}}),Object(w.jsx)("span",{style:{"--i":12}}),Object(w.jsx)("span",{style:{"--i":13}}),Object(w.jsx)("span",{style:{"--i":14}}),Object(w.jsx)("span",{style:{"--i":15}}),Object(w.jsx)("span",{style:{"--i":16}}),Object(w.jsx)("span",{style:{"--i":17}}),Object(w.jsx)("span",{style:{"--i":18}}),Object(w.jsx)("span",{style:{"--i":19}}),Object(w.jsx)("span",{style:{"--i":20}})]})})},z=function(){var e=Object(m.g)(),n=Object(j.useState)(!1),t=Object(f.a)(n,2),a=t[0],s=t[1],r=e.location.pathname.split("/"),i=parseInt(r[r.length-1]);i<1&&(i=1);var c=i?10*(i-1):0,l=Object(x.useQuery)(L,{fetchPolicy:"network-only",variables:Q(i,"main-feed"),pollInterval:3e4,onCompleted:function(){o.feed.links.length<1?s(!1):s(!0)}}),o=l.data,d=l.loading,u=l.error;return d?Object(w.jsx)(P,{}):Object(w.jsxs)(w.Fragment,{children:[u&&Object(w.jsx)("h2",{children:"Villa vi\xf0 a\xf0 s\xe6kja g\xf6gn :("}),o&&Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("div",{className:"link-list",children:o.feed.links.map((function(e,n){return Object(w.jsx)(T,{link:e,index:n+c,page:i},e.id)}))}),Object(w.jsxs)("div",{className:"pageNav",children:[Object(w.jsx)("div",{className:"previousPage pageScroll ".concat(1===i?"hidden":""),onClick:function(){i>1&&e.push("/new/".concat(i-1))},children:"Til baka"}),Object(w.jsx)("div",{className:"nextPage pageScroll ".concat(i<o.feed.count/10?"":"hidden"),onClick:function(){i<o.feed.count/10&&e.push("/new/".concat(i+1))},children:"N\xe6sta s\xed\xf0a"})]}),!a&&Object(w.jsx)("h2",{children:"Engir linkar fundust"})]})]})},G=function(){var e=Object(m.g)(),n=E(),t=Object(f.a)(n,2)[0],a=function(){var e=E(),n=Object(f.a)(e,3)[2],t=Object(x.useApolloClient)();return function(){var e=Object(I.a)($.a.mark((function e(){return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(),e.next=3,t.resetStore();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}(),s=Object(j.useState)(!1),r=Object(f.a)(s,2),i=r[0],c=r[1];return Object(w.jsx)(w.Fragment,{children:Object(w.jsxs)("div",{className:"nav",children:[Object(w.jsx)("div",{className:"logo",children:Object(w.jsx)("a",{href:"/",children:"Linkasafn"})}),Object(w.jsxs)("div",{className:i?"nav-flexGroup slideIn":"nav-flexGroup",children:[Object(w.jsxs)("div",{className:"nav-links",children:[Object(w.jsx)(p.b,{className:"link",to:"/",children:" N\xfdtt "}),Object(w.jsx)("span",{children:"|"}),Object(w.jsx)(p.b,{className:"link",to:"/top",children:"Topp 20"}),Object(w.jsx)("span",{children:"|"}),Object(w.jsx)(p.b,{className:"link",to:"/search",children:"Leita"}),t&&Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)("span",{children:"|"})," ",Object(w.jsx)(p.b,{className:"link",to:"/create",children:"Setja inn Link"})]})]}),Object(w.jsx)("div",{className:"logInOut",children:t?Object(w.jsx)("div",{className:"link",onClick:function(){a(),e.push("/")},children:"Skr\xe1 \xfat"}):Object(w.jsx)(p.b,{to:"/login",className:"link",children:"Innskr\xe1ning"})})]}),Object(w.jsx)("button",{className:"hamburger",onClick:function(){c(!i)},children:"\ud83c\udf54"})]})})},U=function(e){var n=e.formState,t=e.setFormState;return Object(w.jsxs)("div",{className:"form signIn",children:[Object(w.jsx)("input",{className:"input",value:n.email,onChange:function(e){t(Object(h.a)(Object(h.a)({},n),{},{email:e.target.value}))},type:"email",placeholder:"Netfang"}),Object(w.jsx)("div",{className:"form-underline --purple"}),Object(w.jsx)("input",{className:"input",value:n.password,onChange:function(e){t(Object(h.a)(Object(h.a)({},n),{},{password:e.target.value}))},type:"password",placeholder:"Lykilor\xf0"}),Object(w.jsx)("div",{className:"form-underline --purple"})]})},Z=function(e){var n=e.formState,t=e.validationState,a=e.onUpdate,s=Object(j.useRef)();return Object(w.jsxs)("div",{className:"form logIn",children:[Object(w.jsx)("input",{className:"input",value:n.name,onChange:function(e){a(e,"name")},type:"text",placeholder:"Nafn"}),Object(w.jsx)("div",{className:t.name?"form-underline":"form-underline invalid"}),Object(w.jsx)("input",{className:"input",value:n.email,onChange:function(e){a(e,"email")},type:"email",placeholder:"Netfang"}),Object(w.jsx)("div",{className:t.email?"form-underline":"form-underline invalid"}),Object(w.jsx)("input",{className:"input",value:n.password,onChange:function(e){a(e,"password",s)},type:"password",placeholder:"Lykilor\xf0"}),Object(w.jsx)("div",{className:t.password?"form-underline":"form-underline invalid"}),Object(w.jsx)("input",{ref:s,className:"input",value:n.passwordConf,onChange:function(e){a(e,"password2")},type:"password",placeholder:"Sta\xf0festa lykilor\xf0"}),Object(w.jsx)("div",{className:t.passwordConf?"form-underline":"form-underline invalid"}),Object(w.jsx)("div",{className:"validation",children:Object(w.jsxs)("ul",{children:[!t.name&&Object(w.jsx)("li",{children:"Nafn m\xe1 a\xf0eins innihalda stafi. Ver\xf0ur a\xf0 vera a.m.k. tveir stafir"}),!t.email&&Object(w.jsx)("li",{children:"Netfang ver\xf0ur a\xf0 vera gilt."}),!t.password&&Object(w.jsx)("li",{children:"Lykilor\xf0 ver\xf0ur a\xf0 vera a.m.k. 8 a\xf0 lengd, innihalda a.m.k. einn st\xf3ran og einn l\xedtinn staf. M\xe1 innihalda t\xe1kn."}),!t.passwordConf&&Object(w.jsx)("li",{children:"Vinsamlegast sta\xf0festu r\xe9tt lykilior\xf0"})]})})]})},H=t(78),J=t.n(H),R=t(77),K=t.n(R),W=function(){var e=Object(m.g)(),n=E(),t=Object(f.a)(n,2)[1],a=Object(j.useState)({login:!0,email:"",password:"",passwordConf:"",name:""}),s=Object(f.a)(a,2),r=s[0],i=s[1],c=Object(j.useState)({email:!1,password:!1,passwordConf:!1,name:!1}),l=Object(f.a)(c,2),o=l[0],d=l[1],u=Object(j.useState)({isError:!1,message:""}),b=Object(f.a)(u,2),O=b[0],p=b[1];var v=Object(x.useMutation)(y,{variables:{email:r.email,password:r.password},onError:function(e){return p({isError:!0,message:e.message})},onCompleted:function(n){var a=n.login;t(a.token),e.push("/")}}),g=Object(f.a)(v,2),N=g[0],C=g[1],S=C.loading,$=(C.error,Object(x.useMutation)(k,{variables:{name:r.name,email:r.email,password:r.password},onError:function(e){return p({isError:!0,message:e.message})},onCompleted:function(n){var a=n.signup;t(a.token),e.push("/")}})),I=Object(f.a)($,2),B=I[0],q=I[1],M=q.loading;q.error;return S||M?Object(w.jsx)(P,{}):Object(w.jsxs)("div",{children:[Object(w.jsx)("h4",{className:"form-title",children:r.login?"Innskr\xe1ning":"N\xfdskr\xe1ning"}),!r.login&&Object(w.jsx)(Z,{formState:r,validationState:o,setFormState:i,onUpdate:function(e,n,t){switch(n){case"name":i(Object(h.a)(Object(h.a)({},r),{},{name:e.target.value})),K()(e.target.value)&&e.target.value.length>=2?d(Object(h.a)(Object(h.a)({},o),{},{name:!0})):d(Object(h.a)(Object(h.a)({},o),{},{name:!1}));break;case"email":i(Object(h.a)(Object(h.a)({},r),{},{email:e.target.value})),J()(e.target.value)?d(Object(h.a)(Object(h.a)({},o),{},{email:!0})):d(Object(h.a)(Object(h.a)({},o),{},{email:!1}));break;case"password":i(Object(h.a)(Object(h.a)({},r),{},{password:e.target.value})),e.target.value.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,200}$/)?(d(Object(h.a)(Object(h.a)({},o),{},{password:!0})),e.target.value!==t.current.value?d(Object(h.a)(Object(h.a)({},o),{},{password:!0,passwordConf:!1})):d(Object(h.a)(Object(h.a)({},o),{},{password:!0,passwordConf:!0}))):(d(Object(h.a)(Object(h.a)({},o),{},{password:!1})),e.target.value!==t.current.value?d(Object(h.a)(Object(h.a)({},o),{},{password:!1,passwordConf:!1})):d(Object(h.a)(Object(h.a)({},o),{},{password:!1,passwordConf:!0})));break;case"password2":i(Object(h.a)(Object(h.a)({},r),{},{passwordConf:e.target.value})),e.target.value===r.password?d(Object(h.a)(Object(h.a)({},o),{},{passwordConf:!0})):d(Object(h.a)(Object(h.a)({},o),{},{passwordConf:!1}));break;default:return}}}),r.login&&Object(w.jsx)(U,{formState:r,setFormState:i}),Object(w.jsxs)("div",{className:"button-group",children:[Object(w.jsx)("button",{className:r.login||o.name&&o.email&&o.password&&o.passwordConf?"button":"button hidden",onClick:function(e){return r.login?N():o.name&&o.email&&o.password&&o.passwordConf?B():void 0},children:r.login?"Innskr\xe1ning":"N\xfdskr\xe1ning"}),Object(w.jsx)("button",{className:"button",onClick:function(e){p({isError:!1,message:""}),i(Object(h.a)(Object(h.a)({},r),{},{login:!r.login}))},children:r.login?"Skr\xe1 n\xfdjan reikning?":"Aftur \xe1 innskr\xe1ningu"})]}),O.isError&&Object(w.jsxs)("div",{className:"form-error",children:[Object(w.jsx)("h3",{children:"Villa"}),Object(w.jsx)("p",{children:O.message})]})]})},X=function(){var e,n=E(),t=Object(f.a)(n,1)[0];e="/graphql";var a=Object(x.createHttpLink)({uri:e}),s=function(e){return new x.ApolloLink((function(n,t){return e&&n.setContext({headers:{authorization:"Bearer ".concat(e)}}),t(n)}))}(t).concat(a);return new x.ApolloClient({link:s,cache:new x.InMemoryCache({})})},Y=(t(108),function(){var e=Object(j.useState)({queryDone:!1,found:!1}),n=Object(f.a)(e,2),t=n[0],a=n[1],s=Object(j.useState)(""),r=Object(f.a)(s,2),i=r[0],c=r[1],l=Object(x.useLazyQuery)(F,{onCompleted:function(){b.feed.links.length<1?a({queryDone:!0,found:!1}):a({queryDone:!0,found:!0})}}),o=Object(f.a)(l,2),d=o[0],u=o[1],b=u.data;return u.loading?Object(w.jsx)(P,{}):Object(w.jsxs)(w.Fragment,{children:[Object(w.jsxs)("div",{className:"search-box",children:[Object(w.jsxs)("div",{className:"search-bar",children:[Object(w.jsx)("input",{type:"text",placeholder:"Sl\xe1\xf0u inn leitarstreng",onChange:function(e){return c(e.target.value)}}),Object(w.jsx)("div",{className:"search-bar-underline"})]}),Object(w.jsx)("button",{className:"button",onClick:function(){return d({variables:{type:"search-feed",filter:i}})},children:"Hefja leit"})]}),Object(w.jsx)("div",{className:"link-search",children:b&&b.feed.links.map((function(e,n){return Object(w.jsx)(T,{link:e,index:n},e.id)}))}),t.queryDone&&!t.found&&Object(w.jsx)("h2",{children:"Ekkert fannst :/"})]})}),_=t(79),ee=t(80),ne=t(83),te=t(81),ae={textAlign:"center",padding:"1rem"},se=function(e){Object(ne.a)(t,e);var n=Object(te.a)(t);function t(e){var a;return Object(_.a)(this,t),(a=n.call(this,e)).state={hasError:!1},a}return Object(ee.a)(t,[{key:"render",value:function(){return this.state.hasError?Object(w.jsx)("h1",{style:ae,children:"Obbos\xed eithva\xf0 f\xf3r \xfarske\xf0is"}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),t}(d.a.Component),re=function(){return Object(w.jsxs)("div",{className:"page404",children:[Object(w.jsx)("h2",{children:"404 Villa"}),Object(w.jsx)("p",{children:"\xdeetta er ekki s\xed\xf0an sem \xfe\xfa ert a\xf0 leita a\xf0 \ud83d\ude48"}),Object(w.jsx)("iframe",{title:"S\xed\xf0a fannst ekki Gif",src:"https://giphy.com/embed/20k1punZ5bpmM","max-width":"480","max-height":"387",frameBorder:"0"})]})},ie=function(){var e=Object(j.useState)(!1),n=Object(f.a)(e,2),t=n[0],a=n[1],s=Object(m.g)().location.pathname.includes("top"),r=Object(x.useQuery)(A,{variables:{type:"top-feed",skip:0,take:20,orderBy:{votesCount:"desc"}},pollInterval:3e4,onCompleted:function(){i.feed.links.length<1?a(!1):a(!0)}}),i=r.data,c=r.loading,l=r.error;return c?Object(w.jsx)(P,{}):Object(w.jsxs)(w.Fragment,{children:[l&&Object(w.jsx)("h2",{children:"Villa vi\xf0 a\xf0 s\xe6kja g\xf6gn :("}),i&&Object(w.jsxs)("div",{className:"top-links",children:[i.feed.links.map((function(e,n){return Object(w.jsx)(T,{link:e,index:n,isTop:s},e.id)})),!t&&Object(w.jsx)("h2",{children:"Ekkert fannst :/"})]})]})};var ce=function(){var e=X();return Object(w.jsx)(x.ApolloProvider,{client:e,children:Object(w.jsx)(p.a,{children:Object(w.jsxs)("div",{className:"App",children:[Object(w.jsx)(G,{}),Object(w.jsx)(se,{children:Object(w.jsxs)(m.d,{children:[Object(w.jsx)(m.b,{exact:!0,path:"/",render:function(){return Object(w.jsx)(m.a,{to:"/new/1"})}}),Object(w.jsx)(m.b,{exact:!0,path:"/top",component:ie}),Object(w.jsx)(m.b,{exact:!0,path:"/new/:page",component:z}),Object(w.jsx)(m.b,{exact:!0,path:"/search",component:Y}),Object(w.jsx)(m.b,{exact:!0,path:"/login",component:W}),Object(w.jsx)(m.b,{exact:!0,path:"/create",component:C}),Object(w.jsx)(m.b,{component:re})]})})]})})})};b.a.render(Object(w.jsx)(O.a,{children:Object(w.jsx)(ce,{})}),document.getElementById("root"))},89:function(e,n,t){}},[[109,1,2]]]);
//# sourceMappingURL=main.a75fd8f2.chunk.js.map